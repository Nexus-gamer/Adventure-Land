
<!DOCTYPE html>
<html>
<head>
  <title>Minecraft 3D - Estilo 64</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    #inventory {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 4px;
      z-index: 1;
    }
    .slot {
      width: 40px;
      height: 40px;
      border: 2px solid #fff;
      background-color: #222;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }
    .selected {
      border-color: yellow;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.140.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.140.0/examples/js/controls/PointerLockControls.js"></script>
</head>
<body>
  <div id="inventory"></div>
  <script>
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    let renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(0, 50, 0);
    scene.add(light);

    const cubeSize = 1;
    const geometry = new THREE.BoxGeometry(cubeSize, cubeSize, cubeSize);
    const blockColors = ['#228833', '#b87333', '#aaa', '#ffd700', '#00f', '#0ff', '#fff', '#000', '#f00'];

    let blocks = {};
    const cubes = [];

    function addBlock(x, y, z, colorIndex) {
      const material = new THREE.MeshLambertMaterial({ color: blockColors[colorIndex] });
      const cube = new THREE.Mesh(geometry, material);
      cube.position.set(x, y, z);
      scene.add(cube);
      cube.userData = { x, y, z, colorIndex };
      cubes.push(cube);
      const key = `${x},${y},${z}`;
      blocks[key] = cube;
    }

    for (let x = -10; x <= 10; x++) {
      for (let z = -10; z <= 10; z++) {
        addBlock(x, -1, z, 0);
      }
    }

    camera.position.set(0, 2, 5);
    const controls = new THREE.PointerLockControls(camera, document.body);
    document.body.addEventListener('click', () => controls.lock());
    scene.add(controls.getObject());

    const keys = {}, velocity = new THREE.Vector3(), direction = new THREE.Vector3();
    document.addEventListener('keydown', e => keys[e.code] = true);
    document.addEventListener('keyup', e => keys[e.code] = false);

    let selectedSlot = 0;
    const inventory = Array(9).fill(0); // cantidad de bloques por slot
    const blockTypes = Array(9).fill(0).map((_, i) => i);
    inventory[0] = 10;

    const inventoryUI = document.getElementById("inventory");
    let inventoryVisible = true;

    function updateInventoryUI() {
      inventoryUI.innerHTML = '';
      for (let i = 0; i < 9; i++) {
        const slot = document.createElement("div");
        slot.className = "slot" + (i === selectedSlot ? " selected" : "");
        slot.style.backgroundColor = blockColors[blockTypes[i]];
        slot.innerText = inventory[i];
        inventoryUI.appendChild(slot);
      }
      inventoryUI.style.display = inventoryVisible ? 'flex' : 'none';
    }

    updateInventoryUI();

    window.addEventListener('keydown', (e) => {
      if (e.code.startsWith("Digit")) {
        const num = parseInt(e.key);
        if (num >= 1 && num <= 9) {
          selectedSlot = num - 1;
          updateInventoryUI();
        }
      }
      if (e.code === "KeyE") {
        inventoryVisible = !inventoryVisible;
        updateInventoryUI();
      }
    });

    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    function interact(clickType) {
      raycaster.setFromCamera({ x: 0, y: 0 }, camera);
      const intersects = raycaster.intersectObjects(cubes, false);

      if (intersects.length > 0) {
        const hit = intersects[0];
        const distance = hit.distance;
        if (distance <= 4) {
          const pos = hit.object.position;
          const key = `${pos.x},${pos.y},${pos.z}`;

          if (clickType === "break") {
            scene.remove(hit.object);
            cubes.splice(cubes.indexOf(hit.object), 1);
            delete blocks[key];
            if (inventory[selectedSlot] < 64) {
              inventory[selectedSlot]++;
              updateInventoryUI();
            }
          }

          if (clickType === "place") {
            if (inventory[selectedSlot] > 0) {
              const normal = hit.face.normal;
              const placePos = pos.clone().add(normal);
              const newKey = `${placePos.x},${placePos.y},${placePos.z}`;
              if (!blocks[newKey]) {
                addBlock(placePos.x, placePos.y, placePos.z, blockTypes[selectedSlot]);
                inventory[selectedSlot]--;
                updateInventoryUI();
              }
            }
          }
        }
      }
    }

    window.addEventListener('mousedown', (e) => {
      if (e.button === 0) interact("break");
      if (e.button === 2) interact("place");
    });

    function animate() {
      requestAnimationFrame(animate);
      direction.z = Number(keys['KeyW']) - Number(keys['KeyS']);
      direction.x = Number(keys['KeyD']) - Number(keys['KeyA']);
      direction.normalize();
      velocity.x = direction.x * 0.1;
      velocity.z = direction.z * 0.1;
      controls.moveRight(velocity.x);
      controls.moveForward(velocity.z);
      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
